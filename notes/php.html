<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="google34949e442e488102" />













  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="IceHe" />





  <link rel="alternate" href="/atom.xml" title="Ice He" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="http://7vzp68.com1.z0.glb.clouddn.com/common/favicon_h.ico?v=5.1.0" />






<meta name="description" content="Mac 安裝 pecl ，安裝 php extensionInstall PHP pear (要用pecl只要装pear)
PHP 判断某函数是否存在function_exists($function_name)判断一个全局函数是否存在调用方法：$function_name($param)
method_exists($object, $function_name)判断某对象是否存在某方法调用方法">
<meta property="og:type" content="website">
<meta property="og:title" content="PHP Note">
<meta property="og:url" content="http://icehe.me/notes/php.html">
<meta property="og:site_name" content="Ice He">
<meta property="og:description" content="Mac 安裝 pecl ，安裝 php extensionInstall PHP pear (要用pecl只要装pear)
PHP 判断某函数是否存在function_exists($function_name)判断一个全局函数是否存在调用方法：$function_name($param)
method_exists($object, $function_name)判断某对象是否存在某方法调用方法">
<meta property="og:updated_time" content="2016-04-23T12:31:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP Note">
<meta name="twitter:description" content="Mac 安裝 pecl ，安裝 php extensionInstall PHP pear (要用pecl只要装pear)
PHP 判断某函数是否存在function_exists($function_name)判断一个全局函数是否存在调用方法：$function_name($param)
method_exists($object, $function_name)判断某对象是否存在某方法调用方法">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://icehe.me/notes/php.html"/>





  <title>
  

  
    PHP Note | Ice He
  
</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-60837823-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ba81ef13fc65c4dcf8cf8586d25818a4";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  

  <div class="container one-collumn   ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ice He</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">More is in vain when less will serve.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-quote-left"></i> <br />
            
            Articles
          </a>
        </li>
      
        
        <li class="menu-item menu-item-nav">
          <a href="/bookmarks" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-bookmark"></i> <br />
            
            Nav
          </a>
        </li>
      
        
        <li class="menu-item menu-item-cv">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-star"></i> <br />
            
            CV
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

<style type="text/css">
    .center { text-align: center; }
    .bold   { font-weight: bold; }
    .hidden { display: none; }
</style>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
  <header class="post-header">

	<h1 class="post-title" itemprop="name headline">PHP Note</h1>



</header>

    
    
      <p><a href="blog.caesarchi.com/2012/03/mac-pecl-php-extension.html">Mac 安裝 pecl ，安裝 php extension</a><br><a href="http://www.cnblogs.com/bugY/archive/2012/07/06/2578972.html" target="_blank" rel="external">Install PHP pear (要用pecl只要装pear)</a><br><a href=""></a><br><a href=""></a></p>
<h1 id="PHP-判断某函数是否存在"><a href="#PHP-判断某函数是否存在" class="headerlink" title="PHP 判断某函数是否存在"></a>PHP 判断某函数是否存在</h1><p>function_exists($function_name)<br>判断一个全局函数是否存在<br>调用方法：$function_name($param)</p>
<p>method_exists($object, $function_name)<br>判断某对象是否存在某方法<br>调用方法：$object-&gt;$function_name($param)</p>
<p>（例）<br>$funcName = ‘test_func’;<br>method_exists($this, $funcName);<br>$this-&gt;$funcName($param);</p>
<h1 id="PHP-对象的属性使用非常规命名时的访问方法"><a href="#PHP-对象的属性使用非常规命名时的访问方法" class="headerlink" title="PHP 对象的属性使用非常规命名时的访问方法"></a>PHP 对象的属性使用非常规命名时的访问方法</h1><p>object(SimpleXMLElement)[10]<br>  public ‘source-url’ =&gt; string ‘file://C:\wamp\www\t_html_out.html’ (length=34)<br>  public ‘file-name’ =&gt; string ‘t_html_out.html’ (length=15)<br>  public ‘attachment’ =&gt; string ‘true’ (length=4)</p>
<p>如上文中PHP对象的属性名 source-url、file-name，<br>它们使用了非常规的命名，如属性名中带有减号 - 。</p>
<p>导致无法直接使用 $obj-&gt;source-url 的写法来访问！</p>
<p>此时，使用特殊的语法：$obj-&gt;{“source-url”} 来访问。</p>
<h1 id="Where-is-php-ini"><a href="#Where-is-php-ini" class="headerlink" title="Where is php.ini?"></a>Where is php.ini?</h1><p>MacOS，brew 安装的php的 php.ini 文件在：<br>/usr/local/etc/php/版本号/php.ini</p>
<h1 id="PHP-Comm-Func"><a href="#PHP-Comm-Func" class="headerlink" title="PHP Comm Func"></a>PHP Comm Func</h1><p>mock     a. 仿制的，模拟的</p>
<p>str_replace(src, dest, string)<br>urldecode(string)</p>
<p>trim(string, … )<br>Strip whitespace(or other characters) from the beginning and end of string<br>trim     修剪</p>
<p>strip_tags(string, … )<br>Strip HTML and PHP tag from a string<br>strip     剥去</p>
<p>addslashes(string)<br>Quote string with slashes<br>给字符串中的需要转义的字符加上反斜杠（转义符）<br>slash     削减，\反斜杠<br>quote     引用</p>
<p>ctype_type(string)<br>Check for numeric character(s)<br>Check if all of the characters in the provided string, text, are numerical.</p>
<p>ctype_alnum(stirng)<br>Check for alphanumeric character(s)<br>alphabet     字母表<br>alphanumerice     字母数字的</p>
<p>is_integer(var)<br>is_string(var)<br>is_array(var)</p>
<p>array_keys(array)<br>Return all the keys or a subset of the keys of an array</p>
<p>array_diff(array)</p>
<p>array_merge(array)<br>If the input arrays have the same string keys, then the later value for that key will overwrite the previous one. If, however, the arrays contain numeric keys, the later value will not overwrite the original value, but will be appended.</p>
<p>implode(string)<br>explode(string)</p>
<h1 id="Install-PHPUnit-OS-X"><a href="#Install-PHPUnit-OS-X" class="headerlink" title="Install PHPUnit - OS X"></a>Install PHPUnit - OS X</h1><p>操作系统版本：Mac OS 10.10.4 (14E46)</p>
<p><a href="http://gitlab.weibo.cn/mobile-api/mobile-api-v5-application/wikis/unit-test-instruction" target="_blank" rel="external">http://gitlab.weibo.cn/mobile-api/mobile-api-v5-application/wikis/unit-test-instruction</a><br>unit test instruction:<br>PHPUnit生成代码覆盖率需要xdebug插件。所以需要安装该插件。</p>
<p><a href="http://xdebug.org/docs/install" target="_blank" rel="external">http://xdebug.org/docs/install</a><br>XDEBUG EXTENSION FOR PHP | DOCUMENTATION:<br>PECL Installation</p>
<p><a href="http://blog.caesarchi.com/2012/03/mac-pecl-php-extension.html" target="_blank" rel="external">http://blog.caesarchi.com/2012/03/mac-pecl-php-extension.html</a><br>Mac 安裝 pecl ，安裝 php extension:<br>wget <a href="http://pear.php.net/go-pear.phar" target="_blank" rel="external">http://pear.php.net/go-pear.phar</a><br>php -d detect_unicode=0 go-pear.phar</p>
<p>接著會顯示一些選項，如果都不需要可以直接輸入enter跳過， 最後會顯示資訊如下，<br>Would you like to alter php.ini ?<br>當然輸入Y，自動設定php.ini 之後結束安裝。</p>
<p>之後設定自己的PATH 環境變數，加入底下的路徑<br>export PATH=$PATH:/Users/$USER/pear/bin</p>
<p>然后按照《XDEBUG EXTENSION FOR PHP》教程（上文第二个链接）所说，输入以下指令安装XDEBUG<br>pecl install xdebug</p>
<p>发现提示错误：<br>Cannot find autoconf. Please check your autoconf installation and the<br>$PHP_AUTOCONF environment variable. Then, rerun this script.</p>
<p>因此根据要求安装 autoconf<br>brew install autoconf<br>再次执行<br>pecl install xdebug</p>
<p>安装成功后，显示结果的最后一行的用户提示如下：<br>You should add “zend_extension=/usr/lib/php/extensions/no-debug-non-zts-20121212/xdebug.so” to php.ini</p>
<p>然后在php.ini末尾添加如下两行：<br>; MY OWN CONFIG FOR XDEBUG<br>zend_extension=/usr/lib/php/extensions/no-debug-non-zts-20121212/xdebug.so</p>
<p>发现不知道php.ini文件在哪里，使用 php –ini 指令也无法确定位置<br><a href="http://stackoverflyeow.com/questions/9343151/where-is-php-ini-in-mac-os-x-lion-thought-it-was-in-usr-local-php5-lib" target="_blank" rel="external">http://stackoverflyeow.com/questions/9343151/where-is-php-ini-in-mac-os-x-lion-thought-it-was-in-usr-local-php5-lib</a><br>根据以上StackOverflow该问题的第一个答案，了解到系统默认版本的php还没有php.ini<br>sudo cp /private/etc/php.ini.default /private/etc/php.ini</p>
<p>但是拷贝出来的文件没有写权限。<br>不一定按照以下指令执行，具体给那些角色赋予权限要看具体情况<br>sudo chmod a+w php.ini</p>
<p>然后就可以顺利编辑 php.ini 了。</p>
<p>然后根据《unit test instruction》教程（上文第一个链接）继续安装PHPUnit<br>根据以下内容操作无果……<br>“<br>v5代码目录下，包含了phpunit及其依赖包，可以直接执行该phpunit。<br>./vendor/phpunit/phpunit/phpunit –version<br>在tests目录下，执行<br>./vendor/phpunit/phpunit/phpunit src/<br>可以查看执行过程。 为了避免麻烦，也可以直接将./vendor/phpunit/phpunit/phpunit链接到/usr/bin目录下。<br>ln -s /data1/v5.weibo.cn/code/vendor/phpunit/phpunit/phpunit /usr/bin/<br>”</p>
<p>于是，根据《unit test instruction》教程原文，执行“自己通过composer安装phpunit”的步骤。<br>安装composer：<br>curl -sS <a href="https://getcomposer.org/installer" target="_blank" rel="external">https://getcomposer.org/installer</a> | php<br>感觉资源十分不稳定，许多次执行指令后才成功安装，最好选择其它途径下载安装。</p>
<p>执行安装<br>chmod a+x composer.phar<br>php composer.phar install –dev<br>装完……命令行没有识别出phpunit命令，什么鬼！<br>感觉实际上没有装好！我快崩溃了……什么过时教程。</p>
<p>遭遇以上情况，使用brew进行安装<br>$ brew install phpunit<br>Error: No available formula for phpunit<br>Searching formulae…<br>Searching taps…<br>homebrew/php/phpunit-skeleton-generator             homebrew/php/phpunit</p>
<p>这时发现，以上输出的提示 homebrew/php/phpunit，于是使用指令<br>brew install homebrew/php/phpunit</p>
<h1 id="PHP-Encoding-Convert-of-File-amp-Str-文件、字符串编码转换"><a href="#PHP-Encoding-Convert-of-File-amp-Str-文件、字符串编码转换" class="headerlink" title="PHP Encoding Convert of File &amp; Str 文件、字符串编码转换"></a>PHP Encoding Convert of File &amp; Str 文件、字符串编码转换</h1><p><a href="http://www.veryhuo.com/a/view/41348.html" target="_blank" rel="external">http://www.veryhuo.com/a/view/41348.html</a></p>
<p>处理字符串时，需要字符编码转换，<br>碰到iconv转换失败的诡异问题。</p>
<p>因为iconv有bug ，碰到一些生僻字就会无法转换，<br>当然了配置第二个参数时，可以稍微弥补一下默认缺陷，<br>不至于无法转换是截断，用法如下：</p>
<p>iconv(“UTF-8″,”GB2312//IGNORE”,$data);<br>//IGNORE的意思是，碰到无法转换的字符，<br>//忽略失败，继续转换下面的内容。</p>
<p>可以用另一个转换函数（mb_convert_encoding），<br>此函数效率不高，另外可省略第三参数，<br>自动识别内容编码，最好别用，影响效率，<br>还需注意，mb_convert_encoding和iconv参数顺序不同。</p>
<p>mb_convert_encoding ( string $str , string $to_encoding [, mixed $from_encoding = mb_internal_encoding() ] )<br><a href="http://php.net/manual/zh/function.mb-convert-encoding.php" target="_blank" rel="external">http://php.net/manual/zh/function.mb-convert-encoding.php</a></p>
<h1 id="PHP-Why-无法调用一个存在的库函数"><a href="#PHP-Why-无法调用一个存在的库函数" class="headerlink" title="PHP Why 无法调用一个存在的库函数"></a>PHP Why 无法调用一个存在的库函数</h1><p>当PHP的错误报告出现下文：<br>PHP Fatal error:  Call to undefined function mb_convert_encoding() in C:\Users\IceHe\script\y.php on line 4</p>
<p>解决方法：<br>例如上文中找不到的函数是 mb_convert_encoding。<br>我搞清楚了它所在的dll（动态链接库）名为php_mbstring.dll，<br>此文件在php安装目录（C:\php）下的文件夹ext中。</p>
<p>1.在php安装路径的根目录下，<br>     找到php.ini文件，如：c:/php/php.ini。<br>2.找到Dynamic Extensions的段落，在其中<br>     反注释 或 添加 以下这一句：<br>     extension=./ext/php_mbstring.dll<br>（即extension= path/php_mbstring.dll，路径加文件名）<br>3.命令行下，输入php /? 看看有没有载入成功。<br>     可能会显示：<br>Warning: PHP Startup: Unable to load dynamic library ‘C:\php\php_mbstring.dll’ -<br>The specified module could not be found.<br>in Unknown on line 0<br>Could not open input file: /?</p>
<p>4.重启apache等webserver<br>     即可使用原来找不到的函数~<br>     CLI（命令行/脚本）模式下则不需要。</p>
<h1 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h1><p>SPL<br>Standard PHP Library</p>
<p>PHPUnit是PHP应用的单元测试框架的业界标准</p>
<p>PHP通过内置的FastCGI进程管理器(FPM)，可以非常高效地和轻量级的高性能Web服务器nginx进行通信。<br>nginx比Apache消耗更少的内存，能更好的处理并发请求，这在内存限制较多的虚拟主机环境中尤为重要。</p>
<p>Redis<br>是一个开源、支持网络、基于内存，的高性能Key-Value存储系统（cache and store）。使用ANSI C编写。<br>通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Map), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。</p>
<p>Composer<br>新一代的PHP依赖管理工具，服务于 PHP 生态系统。<br>其中的很多理念都借鉴了 npm 和 Bundler。<br>它实际上包含了两个部分：Composer 和 Packagist</p>
<p>Composer 是一个命令行工具，帮你为项目自动安装所依赖的开发包。<br>它包含了一个依赖解析器，用来处理开发包之间复杂的依赖关系；<br>另外，它还包含了下载器、安装器等。</p>
<p>Packageist 是 Composer 的默认的开发包仓库。<br>可以将自己的安装包提交到 packagist，将来你在自己的 VCS （源码管理软件，比如 Github） 仓库中<br>新建了 tag 或更新了代码，packagist 都会自动构建一个新的开发包。<br>这就是 packagist 目前的运作方式，将来 packagist 将允许直接上传开发包。</p>
<p>XDebug<br>调试器是软件开发过程中非常重要的一个工具，通过它，可以跟踪代码的执行过程，查看堆栈信息。<br>XDebug是一个PHP调试器，可以集成在常见的IDE中，提供设置断点、 查看堆栈信息等功能，<br>还可以和PHPUnit、KCacheGrind等工具配合，执行代码覆盖率测试和性能调优。</p>
<p>依赖管理<br>如今有大量的PHP函数库、框架和组件可供选择，一个项目中可能会使用其中的若干——即项目的依赖。<br>到目前为止，PHP还没有有效的 项目依赖管理方案。即使你手工的管理它们，你还不得不处理其自动加载问题。</p>
<p>目前主要有两个PHP包管理系统：Composer和PEAR，哪个适合你？答案是两个都需要。<br>    管理单个项目的依赖时使用Composer<br>    管理整个系统的PHP依赖时使用PEAR</p>
<p>通常情况下，Composer包只在你项目中明确指定时才可用，而PEAR包在所有的PHP项目中可用。<br>尽管PEAR听起来似乎更简单，但是根据每个 项目制定方案可能更合适。</p>
<p>缓存<br>PHP自身效率很高，但是执行创建远程连接、加载文件等操作时容易出现瓶颈，<br>幸运的是，我们有很多工具来加速这部分操作，或减少 这些耗时操作的执行次数。</p>
<p>字节码缓存：在一个PHP文件被执行时，它先被编译为字节码(也称opcode)，然后这些字节码被执行。<br>如果文件没有修改，那么字节码也会保持不变， 这意味着编译这一步白白浪费了CPU资源。</p>
<p>对象缓存：如果在取得一些数据之后，把它们缓存在系统中，<br>在后续对这些数据的请求 中，就可以直接使用缓存中的对象（对象变化较少），<br>这么做可以很大地提升系统性能，减少服务器的负载。<br>使用最多的内存对象缓存系统是APCu和memcached。<br>APCu是很好的一个对象缓存方案，它提供了简单的API来让你把对象存储在内存中，<br>而且 配置和使用都非常容易，它的一个缺点是只能在本机使用。<br>Memcached则是另外一种方式，它是一个单独的服务，<br>可以通过网络访问，这 意味着可以在一个地方写入数据，然后在不同的系统中访问这份数据。</p>
<p>框架<br>框架抽象出底层通用的业务逻辑，给使用者了提供简单易用的接口。<br>不是所有的项目都需要框架，有时候原生的PHP就能满足需求，但需要框架时，有三种类型的框架可供选择：</p>
<p>1 微框架：仅是一个包装器(Wrapper)，尽量快地把HTTP请求路由到回调函数、控制器或方法上，<br>有些框架也会提供一些函数库，如基本的数据库 操作。微框架主要用于构建远程HTTP服务。</p>
<p>2 全能(Full-Stack)框架：在微框架的功能之上提供了更多的功能特性，如ORM，验证组件等。</p>
<p>3 组件框架：一组独立功能库的集合，多个基于组件的框架集合在一起，甚至可以用作微框架或者全能框架。</p>
<p>组件<br>如前所述，组件是另外一种创建、实现和发布开源代码的方式，当前社区存在很多组件库，最主要的两个：<br>    Packagist<br>    PEAR<br>这两个库都有用于安装和升级的命令行工具，已经在依赖管理部分讲述.</p>
<p>Master-Slave<br>It’s a model of communication where one device or process has unidirectional control over one or more other devices. In some systems a master is elected from a group of eligible devices, with the other devices acting in the role of slaves.<br>In database replication, the master database is regarded as the authoritative source, and the slave databases are synchronized to it.</p>
<p>Abbr List<br>MC     memcache<br>Vendor     供应商<br>BDD     行为驱动开发</p>
<p>PHP 编码规范 - 过去未注意的部分<br>*（部门内使用，参考公认的标准，有参考价值）</p>
<p>控制结构的关键字后必须要有一个空格符，而调用方法或函数时则一定不能有。</p>
<p>纯PHP代码文件必须省略最后的 ?&gt; 结束标签。</p>
<p>// 类声明范例<br>&lt;?php<br>namespace Vendor\Package;</p>
<p>use FooClass;<br>use BarClass as Bar;<br>use OtherVendor\OtherPackage\BazClass;</p>
<p>class ClassName extends ParentClass implements<br>    \ArrayAccess,<br>    \Countable,<br>    \Serializable<br>{<br>    // constants, properties, methods<br>}</p>
<p>简单数组的新声明方式！<br>&lt;?php<br>$array = array(<br>    “foo” =&gt; “bar”,<br>    “bar” =&gt; “foo”,<br>);</p>
<p>// 自 PHP 5.4 起<br>$array = [<br>    “foo” =&gt; “bar”,<br>    “bar” =&gt; “foo”,<br>];<br>?&gt;</p>
<p>From: www.laruence.com/manual/yaf.classes.html#yaf.class.application.props._app<br>_app<br>    Yaf_Application通过特殊的方式实现了单利模式, 此属性保存当前实例</p>
<h1 id="单例模式-误为-单利模式"><a href="#单例模式-误为-单利模式" class="headerlink" title="单例模式 误为 单利模式"></a>单例模式 误为 单利模式</h1>
    
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_switch" class="center">
          <a href="javascript:loadDisqus();">
            Click to load Disqus (查看评论需翻墙)
          </a>
      </div>
      <script type="text/javascript">
        function loadDisqus() {
          $('#disqus_switch').hide();
          $('#disqus_thread').show();
          run_disqus_script('embed.js');
        }
      </script>
      <div id="disqus_thread" style="display:none;">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7vzp68.com1.z0.glb.clouddn.com/about/avatar_pretty_00.png"
               alt="Ice He" />
          <p class="site-author-name" itemprop="name">Ice He</p>
           
              <p class="site-description motion-element" itemprop="description">Less.</p>
          
        </div>

        <div class="hidden post-toc" style="max-height: 1220px; width: calc(100% + 0px);" id="popular-post-div">
          <div class="post-toc-content">
            <ol class="nav" id="popular-list"></ol>
          </div>
        </div>

        <!--
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/">
                <span class="site-state-item-count">50</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">categs</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        
        -->

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <!--
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  - <span class="author" itemprop="copyrightHolder">Ice He</span>. &nbsp;All rights reserved.
  -->
  <span class="author" itemprop="copyrightHolder">IceHe</span>
</div>



        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
  
</div>



        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'https-icehe-me';
      var disqus_identifier = 'notes/php.html';

      var disqus_title = "PHP Note";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        //run_disqus_script('embed.js');
      

    </script>
  











  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("u1mg4ase5iwhhnyqlavbmd5lkbj7mb5oy4linckob65z1axp", "fe7peybzqmpgludkwu43fk15s655i8neejt3pkoezlqtbeu5");</script>
  <script>
    function timeDesc(time) {
      return time / 1000 >= 1 ? '1k +' : (
        time / 600 >= 1 ? '600 +' : (
          time / 300 >= 1 ? '300 +' : (
            time / 100 >= 1 ? '100 +' : '99 -'
          )
        )
      );
    }

    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            if (time < 300) {
              continue;
            }
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(timeDesc(time));
            $(element).removeClass('hidden');
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            if ((-1 != location.href.indexOf("icehe.me")) // 在 icehe.me 的域名下
              && (-1 == location.href.indexOf("icehe.me/notes/")) // 不在 icehe.me/notes 的域名下
            ) {
              counter.increment("time");
              counter.save(null, {
                success: function(counter) {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(timeDesc(counter.get('time')));
                },
                error: function(counter, error) {
                  console.log('Failed to save Visitor num, with error message: ' + error.message);
                }
              });
            }
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(timeDesc(newcounter.get('time')));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    function ranking(Counter, is_post) {
        var popular_list = $('#popular-list2');
        var is_post = (popular_list.length == 1);
        var count = is_post ? 20 : 10;
        if (!is_post) {
            // return; // Break for Simplicity!
            popular_list = $('#popular-list');
            if (popular_list.length == 0) {
                return;
            }
            $('#popular-post-div').removeClass('hidden');
        }

        var query = new AV.Query(Counter);
        query.descending('time');
        query.limit(count + 10);

        //var regex = new RegExp('^.*?(?<!linux).*$', 'i');
        //query.matches('url', regex);

        var excluding_list = [
            '/about/',
            '/bookmarks/',
            '/reward/',
            '/search/', /* Hidden */
            '/index/', /* Removed */
            '/resume/', /* Removed */
            '/linux/[06] Linux 通过 pip 安装使用 Shadowsocks - CentOS 7/',
            '/linux/[05] 自动挂载 NTFS 格式的 硬盘分区 - CentOS 7/',
            '/linux/[04] 安装 CentOS 7 后必做的 安全防范措施/',
            '/linux/[03] Update Kernel 升级内核 - CentOS 7/',
            '/linux/[02] Config System Envir 配置系统环境 - CentOS 7/',
            '/linux/[01] 恢复 Windows 的 开机引导 - CentOS 7/',
            '/linux/[00] U盘安装 CentOS 7/'
        ];
        query.notContainedIn('url', excluding_list);

        query.limit(count);
        query.find()
            .done(function (results) {
                if (results.length === 0) {
                    return;
                }

                    popular_list.append(
                        '<li class="nav-item nav-level-1 bold" style="'
                        + 'border-bottom-width: 1px; '
                        + 'border-bottom-style: solid; '
                        + 'border-bottom-color: #ccc;"> '
                        + '<i class="fa fa-fire"></i> &nbsp;'
                        + '<span class="nav-text"> PV </span> '
                        + '</li>'
                    );
                for (var i = 0; i < results.length; ++i) {
                    var counter = results[i];
                    var title = counter.get("title");
                    var time = timeDesc(counter.get('time'));

                    popular_list.append(
                        '<li class="nav-item nav-level-1" '
                        + ((i + 1) % 10 == 0
                            ? 'style="border-bottom-width: 1px; '
                                + 'border-bottom-style: solid;'
                                + 'border-bottom-color: #ccc;"'
                            : '')
                        + '> '
                        + '<span class="nav-number"> '
                        + ((i + 1) % 10) + '. &nbsp;'
                        + '</span> '
                        + '<a class="nav-link" href="' + counter.get("url") + '"> '
                        + '<span class="nav-text"> ' + counter.get('title') + ' </span> '
                        + '</a> '
                        + '<span class="nav-number"> '
                        + '<sup> &nbsp;' + time + ' </sup> '
                        + '</span> '
                        + '</li>'
                    );
                }
                if (!is_post) {
                    popular_list.append(
                        '<li class="nav-item nav-level-1"> '
                        //+ '<i class="fa fa-eye"></i> &nbsp;'
                        + '+. &nbsp; '
                        + '<a class="nav-link" href="/bookmarks"><span class="nav-text bold">More </span></a> </li>'
                    );
                    popular_list.append(
                        '<li class="nav-item nav-level-1"> '
                        + '<span class="nav-number"> &nbsp; </span> '
                        + '<a class="nav-link" href="/bookmarks"> '
                        + '<span class="nav-text"> &nbsp; </span></a> '
                        + '</li>'
                    );
                }
          })
          .fail(function (object, error) {
              console.log("Error: " + error.code + " " + error.message);
          });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('#is_index').length == 1) {
        showTime(Counter);
      } else {
        addCount(Counter);
      }
      // 等待 Next 开源项目的人修复
      //if ($('.leancloud_visitors').length == 1) {
      //  addCount(Counter);
      //} else if ($('.post-title-link').length > 1) {
      //  showTime(Counter);
      //}
      ranking(Counter);
    });
  </script>



  
  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


  

</body>
</html>
